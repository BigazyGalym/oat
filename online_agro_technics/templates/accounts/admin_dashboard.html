{% extends 'base.html' %}
{% load static %}
{% block title %}–ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å{% endblock %}

{% block content %}
{% if request.user.profile.is_admin %}
<div class="container mx-auto px-4 py-10">
    <h1 class="text-4xl font-extrabold text-gray-900 mb-10">üë®‚Äçüíº –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
        <div class="bg-white shadow-md rounded-xl p-6 border-t-4 border-green-500">
            <h2 class="text-gray-600">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</h2>
            <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.total_orders }}</p>
        </div>
        <div class="bg-white shadow-md rounded-xl p-6 border-t-4 border-blue-500">
            <h2 class="text-gray-600">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
            <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.active_orders }}</p>
        </div>
        <div class="bg-white shadow-md rounded-xl p-6 border-t-4 border-yellow-500">
            <h2 class="text-gray-600">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
            <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.users }}</p>
        </div>
        <div class="bg-white shadow-md rounded-xl p-6 border-t-4 border-pink-500">
            <h2 class="text-gray-600">–¢–∏–∫–µ—Ç—ã –≤ –æ–∂–∏–¥–∞–Ω–∏–∏</h2>
            <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.pending_tickets }}</p>
        </div>
    </div>

    <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
        <div class="bg-white shadow-md rounded-xl p-6 border-t-4 border-indigo-500">
            <h2 class="text-gray-600">–†–∞–±–æ—á–∏–µ</h2>
            <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.workers }}</p>
        </div>
        <div class="bg-white shadow-md rounded-xl p-6 border-t-4 border-cyan-500">
            <h2 class="text-gray-600">–ö–ª–∏–µ–Ω—Ç—ã</h2>
            <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.customers }}</p>
        </div>
        <div class="bg-white shadow-md rounded-xl p-6 border-t-4 border-purple-500">
            <h2 class="text-gray-600">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
            <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.completed_orders }}</p>
        </div>
    </div>

    <div class="mb-6">
        <label for="filterSelect" class="block mb-2 font-semibold text-gray-700">–§–∏–ª—å—Ç—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏:</label>
        <select id="filterSelect" class="border rounded-lg px-4 py-2">
            <option value="day">–ö“Ø–Ω —Å–∞–π—ã–Ω</option>
            <option value="week">–ê–ø—Ç–∞ —Å–∞–π—ã–Ω</option>
            <option value="month" selected>–ê–π —Å–∞–π—ã–Ω</option>
            <option value="year">–ñ—ã–ª —Å–∞–π—ã–Ω</option>
        </select>
    </div>

    

    <!-- –î–∏–∞–≥—Ä–∞–º–º–∞ –∑–∞–∫–∞–∑–æ–≤ -->
    <div class="bg-white rounded-xl shadow-md p-6 mb-12">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤</h2>
        <canvas id="ordersChart" class="h-64"></canvas>
    </div>


    

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã -->
    <div class="bg-white rounded-xl shadow-md p-6 mb-12">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">üì¶ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full text-left text-sm text-gray-700">
                <thead class="bg-gray-100 font-bold text-gray-800">
                    <tr>
                        <th class="px-6 py-3">ID</th>
                        <th class="px-6 py-3">–£—Å–ª—É–≥–∞</th>
                        <th class="px-6 py-3">–†–∞–π–æ–Ω</th>
                        <th class="px-6 py-3">–ö–ª–∏–µ–Ω—Ç</th>
                        <th class="px-6 py-3">–°—Ç–∞—Ç—É—Å</th>
                        <th class="px-6 py-3">–°–æ–∑–¥–∞–Ω</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in recent_orders %}
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-6 py-4">{{ order.id }}</td>
                        <td class="px-6 py-4">{{ order.service_type.name }}</td>
                        <td class="px-6 py-4">{{ order.district }}</td>
                        <td class="px-6 py-4">{{ order.customer_id.username }}</td>
                        <td class="px-6 py-4">{{ order.get_status_display }}</td>
                        <td class="px-6 py-4">{{ order.created_at|date:"d.m.Y H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="6" class="text-center text-gray-500 py-6">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ -->
    <div class="bg-white rounded-xl shadow-md p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">üõéÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full text-left text-sm text-gray-700">
                <thead class="bg-gray-100 font-bold text-gray-800">
                    <tr>
                        <th class="px-6 py-3">ID</th>
                        <th class="px-6 py-3">–¢–µ–º–∞</th>
                        <th class="px-6 py-3">–°—Ç–∞—Ç—É—Å</th>
                        <th class="px-6 py-3">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                        <th class="px-6 py-3">–ö–ª–∏–µ–Ω—Ç</th>
                        <th class="px-6 py-3">–î–∞—Ç–∞</th>
                        <th class="px-6 py-3">–î–µ–π—Å—Ç–≤–∏–µ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ticket in tickets %}
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-6 py-4">{{ ticket.id }}</td>
                        <td class="px-6 py-4">{{ ticket.title }}</td>
                        <td class="px-6 py-4">{{ ticket.get_status_display }}</td>
                        <td class="px-6 py-4">{{ ticket.get_priority_display }}</td>
                        <td class="px-6 py-4">{{ ticket.user.username }}</td>
                        <td class="px-6 py-4">{{ ticket.created_at|date:"d.m.Y H:i" }}</td>
                        <td class="px-6 py-4">
                            <a href="{% url 'helpdesk:ticket_detail' ticket.id %}" class="text-blue-600 hover:underline">–û—Ç–∫—Ä—ã—Ç—å</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="7" class="text-center text-gray-500 py-6">–ù–µ—Ç —Ç–∏–∫–µ—Ç–æ–≤.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Chart.js Script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('ordersChart').getContext('2d');
new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['–î–æ—Å—Ç—É–ø–Ω—ã', '–ü—Ä–∏–Ω—è—Ç—ã', '–í –ø—Ä–æ—Ü–µ—Å—Å–µ', '–ó–∞–≤–µ—Ä—à–µ–Ω—ã', '–û—Ç–º–µ–Ω–µ–Ω—ã'],
        datasets: [{
            label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤',
            data: [
                {{ stats.available_orders }},
                {{ stats.accepted_orders }},
                {{ stats.in_progress_orders }},
                {{ stats.completed_orders }},
                {{ stats.cancelled_orders }}
            ],
            backgroundColor: ['#facc15', '#60a5fa', '#fb923c', '#34d399', '#f87171'],
            borderRadius: 6
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: { beginAtZero: true }
        }
    }
});
</script>

{% else %}
<!-- Access Denied -->
<div class="container mx-auto py-10">
    <div class="bg-red-100 text-red-700 p-6 rounded-xl text-center shadow-md">
        <p class="text-2xl font-semibold">‚õî –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.</p>
    </div>
</div>
{% endif %}
{% endblock %}
